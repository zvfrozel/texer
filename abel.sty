% Last updated Dec 17 2025

\ProvidesPackage{abel}
\makeatletter

% --------------------------------------------------------------------
% Basic packages
% --------------------------------------------------------------------
\usepackage[english]{babel}
\frenchspacing

\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{mathrsfs}
\usepackage{mathtools}
\allowdisplaybreaks

\usepackage{decimal}
\usepackage{yhmath}

\usepackage[shortlabels]{enumitem}
\usepackage{ellipsis} % nicer ellipsis

% --------------------------------------------------------------------
% Text styles
% --------------------------------------------------------------------

\newcommand{\qfootnote}[1]{\begin{flushright}\textit{#1}\end{flushright}}

% --------------------------------------------------------------------
% New math commands
% --------------------------------------------------------------------
\providecommand{\half}[1][1]{\frac{#1}{2}}
\newcommand{\recip}[1]{\frac{1}{#1}}
\newcommand{\ub}{\underbrace}
\newcommand{\oveq}[2][=]{\overset{#2}{#1}}
\newcommand{\amgm}[1][=]{\overset{\text{AM-GM}}{#1}} % wrapper for oveq

\newcommand{\qutext}[2][1em]{\hskip#1\relax\text{#2}\hskip#1\relax}
\newcommand{\queq}[1][1em]{\qutext[#1]{$=$}}
\newcommand{\quand}[1][2em]{\qutext[#1]{and}}

\newcommand{\ev}[1]{{\mathbb E}\left[#1\right]}
\newcommand{\prob}[1]{{\mathbb P}\left[#1\right]}

% Script letters
\newcommand{\SP}{\mathcal P}
\newcommand{\SQ}{\mathcal Q}
\newcommand{\MS}{\mathcal S} % already used sometimes

% --------------------------------------------------------------------
% Macros
% --------------------------------------------------------------------
\newcommand{\cbrt}[1]{\sqrt[3]{#1}}
\newcommand{\floor}[1]{\left\lfloor #1 \right\rfloor}
\newcommand{\ceiling}[1]{\left\lceil #1 \right\rceil}

\newcommand{\ol}{\overline}
\newcommand{\ul}{\underline}
\newcommand{\wt}{\widetilde}
\newcommand{\wh}{\widehat}
\newcommand{\eps}{\varepsilon}
\providecommand{\arc}[1]{\wideparen{#1}}

\DeclareMathOperator{\cis}{cis}
\DeclareMathOperator*{\lcm}{lcm}
\DeclareMathOperator*{\argmin}{arg min}
\DeclareMathOperator*{\argmax}{arg max}

\newcommand{\cycsum}{\sum_{\mathrm{cyc}}}
\newcommand{\symsum}{\sum_{\mathrm{sym}}}
\newcommand{\cycprod}{\prod_{\mathrm{cyc}}}
\newcommand{\symprod}{\prod_{\mathrm{sym}}}

\newcommand{\CC}{\mathbb C}
\newcommand{\FF}{\mathbb F}
\newcommand{\NN}{\mathbb N}
\newcommand{\QQ}{\mathbb Q}
\newcommand{\RR}{\mathbb R}
\newcommand{\ZZ}{\mathbb Z}
\newcommand{\charin}{\text{ char }}
\DeclareMathOperator{\sign}{sign}
\DeclareMathOperator{\Aut}{Aut}
\DeclareMathOperator{\Inn}{Inn}
\DeclareMathOperator{\Syl}{Syl}
\DeclareMathOperator{\Gal}{Gal}
\DeclareMathOperator{\GL}{GL} % general linear group
\DeclareMathOperator{\SL}{SL} % special linear group
\DeclareMathOperator{\Vol}{Vol}

\newcommand{\abs}[1]{\left\lvert #1 \right\rvert}
\newcommand{\norm}[1]{\left\lVert #1 \right\rVert}
\newcommand{\dang}{\measuredangle} %% directed angle
\newcommand{\ray}[1]{\overrightarrow{#1}}
\newcommand{\seg}[1]{\overline{#1}}
\DeclareMathOperator{\id}{id}
\newcommand{\taking}[1]{\xrightarrow{#1}}
\newcommand{\inv}{^{-1}}
\DeclareMathOperator{\diam}{diam}
\DeclareMathOperator{\ord}{ord}
\newcommand{\defeq}{\overset{\mathrm{def}}{=}}
\newcommand{\ts}{\textsuperscript}
\newcommand{\dg}{^\circ}

\newcommand{\ii}{\item}
\newcommand{\liff}{\leftrightarrow}
\newcommand{\lthen}{\rightarrow}
\newcommand{\opname}{\operatorname}
\newcommand{\surjto}{\twoheadrightarrow}
\newcommand{\injto}{\hookrightarrow}
\newcommand{\On}{\mathrm{On}} % ordinals
\DeclareMathOperator{\img}{im}
\DeclareMathOperator{\Img}{Im}
\DeclareMathOperator{\coker}{coker}
\DeclareMathOperator{\Coker}{Coker}
\DeclareMathOperator{\Ker}{Ker}
\DeclareMathOperator{\rank}{rank}
\DeclareMathOperator{\Spec}{Spec}
\DeclareMathOperator{\Tr}{Tr}
\DeclareMathOperator{\pr}{pr}
\DeclareMathOperator{\ext}{ext}
\DeclareMathOperator{\pred}{pred}
\DeclareMathOperator{\dom}{dom}
\DeclareMathOperator{\ran}{ran}
\DeclareMathOperator{\Hom}{Hom}
\DeclareMathOperator{\Mor}{Mor}
\DeclareMathOperator{\End}{End}

\newcommand{\kb}{\mathfrak b}
\newcommand{\kg}{\mathfrak g}
\newcommand{\kh}{\mathfrak h}
\newcommand{\kn}{\mathfrak n}
\newcommand{\ku}{\mathfrak u}
\newcommand{\kz}{\mathfrak z}
\DeclareMathOperator{\Ext}{Ext}
\DeclareMathOperator{\Tor}{Tor}
\newcommand{\gl}{\opname{\mathfrak{gl}}}
\def\sl{\opname{\mathfrak{sl}}}

\newcommand{\SA}{\mathcal A}
\newcommand{\SB}{\mathcal B}
\newcommand{\SC}{\mathcal C}
\newcommand{\SF}{\mathcal F}
\newcommand{\SG}{\mathcal G}
\newcommand{\SH}{\mathcal H}
\newcommand{\OO}{\mathcal O}

\newcommand{\SCA}{\mathscr A}
\newcommand{\SCB}{\mathscr B}
\newcommand{\SCC}{\mathscr C}
\newcommand{\SCD}{\mathscr D}
\newcommand{\SCE}{\mathscr E}
\newcommand{\SCF}{\mathscr F}
\newcommand{\SCG}{\mathscr G}
\newcommand{\SCH}{\mathscr H}

\newcommand{\km}{\mathfrak m}
\newcommand{\kp}{\mathfrak p}
\newcommand{\kq}{\mathfrak q}

% --------------------------------------------------------------------
% Asymptote setup (Evan)
% --------------------------------------------------------------------
\usepackage{asymptote}

\begin{asydef}
defaultpen(fontsize(10pt));
size(8cm);
usepackage("amsmath");
usepackage("amssymb");
settings.tex="pdflatex";
settings.outformat="pdf";
import geometry;

// recalibrate fill and filldraw for conics
void filldraw(picture pic = currentpicture, conic g,
              pen fillpen=defaultpen, pen drawpen=defaultpen)
{ filldraw(pic, (path) g, fillpen, drawpen); }

void fill(picture pic = currentpicture, conic g, pen p=defaultpen)
{ filldraw(pic, (path) g, p); }

// geometry helpers
pair foot(pair P, pair A, pair B) { return foot(triangle(A,B,P).VC); }
pair centroid(pair A, pair B, pair C) { return (A+B+C)/3; }

// cse5 abbreviations
path CP(pair P, pair A) { return circle(P, abs(A-P)); }
path CR(pair P, real r) { return circle(P, r); }
pair IP(path p, path q) { return intersectionpoints(p,q)[0]; }
pair OP(path p, path q) { return intersectionpoints(p,q)[1]; }
path Line(pair A, pair B, real a=0.6, real b=a)
{ return (a*(A-B)+A)--(b*(B-A)+B); }

// cse5 drawing helpers
picture CC() {
  picture p = rotate(0)*currentpicture;
  currentpicture.erase();
  return p;
}

pair MP(Label s, pair A, pair B = plain.S, pen p = defaultpen) {
  Label L = s;
  L.s = "$"+s.s+"$";
  label(L, A, B, p);
  return A;
}

pair Drawing(Label s = "", pair A, pair B = plain.S, pen p = defaultpen) {
  dot(MP(s, A, B, p), p);
  return A;
}

path Drawing(path g, pen p = defaultpen, arrowbar ar = None) {
  draw(g, p, ar);
  return g;
}
\end{asydef}

% --------------------------------------------------------------------
% Hyperref setup
% --------------------------------------------------------------------
\usepackage[svgnames,dvipsnames,table]{xcolor}
\usepackage[colorlinks=true,pdfusetitle]{hyperref}
\hypersetup{urlcolor=RubineRed,linkcolor=RoyalBlue,citecolor=ForestGreen}

\newcommand\fake@secnum[3][]{%
  \refstepcounter{#2}%
  \phantomsection
  \if\relax\detokenize{#1}\relax
    \addcontentsline{toc}{#2}{%
      \protect\numberline{\csname the#2\endcsname}#3}%
  \else
    \addcontentsline{toc}{#2}{%
      \texorpdfstring{\protect\numberline{\csname the#2\endcsname}#3}{#1}}%
  \fi}
\newcommand\fake@secstar[3][]{%
  \phantomsection
  \if\relax\detokenize{#1}\relax
    \addcontentsline{toc}{#2}{#3}%
  \else
    \addcontentsline{toc}{#2}{\texorpdfstring{#3}{#1}}%
  \fi}

\newcommand\fake@section[2][]{\fake@secnum[#1]{section}{#2}}
\newcommand\fake@sectionstar[2][]{\fake@secstar[#1]{section}{#2}}
\newcommand\fake@subsection[2][]{\fake@secnum[#1]{subsection}{#2}}
\newcommand\fake@subsectionstar[2][]{\fake@secstar[#1]{subsection}{#2}}
\newcommand\fakesection{\@ifstar\fake@sectionstar\fake@section}
\newcommand\fakesubsection{\@ifstar\fake@subsectionstar\fake@subsection}

% --------------------------------------------------------------------
% Theorem + mdframed setup
% --------------------------------------------------------------------
\usepackage{amsthm}
\usepackage{thmtools}

\usepackage[framemethod=TikZ]{mdframed}
\usetikzlibrary{shadows}

% Fix mdframed + lists interaction
\usepackage{xpatch}
\xpatchcmd{\endmdframed}
  {\aftergroup\endmdf@trivlist\color@endgroup}
  {\endmdf@trivlist\color@endgroup\@doendpe}
  {}{}

% Blue theorem/proposition box
\mdfdefinestyle{mdbluebox}{%
  roundcorner=10pt,
  linewidth=1pt,
  skipabove=12pt,
  innerbottommargin=9pt,
  skipbelow=2pt,
  linecolor=blue,
  nobreak=true,
  backgroundcolor=TealBlue!5,
}
\declaretheoremstyle[
  headfont=\sffamily\bfseries\color{MidnightBlue},
  mdframed={style=mdbluebox},
  headpunct={\\[3pt]},
  postheadspace={0pt}
]{thmbluebox}

% Red example box
\mdfdefinestyle{mdredbox}{%
  linewidth=0.5pt,
  skipabove=12pt,
  frametitleaboveskip=5pt,
  frametitlebelowskip=0pt,
  skipbelow=2pt,
  frametitlefont=\bfseries,
  innertopmargin=4pt,
  innerbottommargin=8pt,
  nobreak=true,
  backgroundcolor=Salmon!5,
  linecolor=RawSienna,
}
\declaretheoremstyle[
  headfont=\bfseries\color{RawSienna},
  mdframed={style=mdredbox},
  headpunct={\\[3pt]},
  postheadspace={0pt},
]{thmredbox}

% Green algorithm/claim sidebar
\mdfdefinestyle{mdgreenbox}{%
  skipabove=8pt,
  skipbelow=0pt,
  linewidth=2pt,
  rightline=false,
  leftline=true,
  topline=false,
  bottomline=false,
  linecolor=ForestGreen,
  backgroundcolor=ForestGreen!5,
}
\declaretheoremstyle[
  headfont=\bfseries\sffamily\color{ForestGreen!70!black},
  bodyfont=\normalfont,
  spaceabove=2pt,
  spacebelow=1pt,
  mdframed={style=mdgreenbox},
  headpunct={ --- },
]{thmgreenbox}

% Black remark sidebar
\mdfdefinestyle{mdblackbox}{%
  skipabove=8pt,
  linewidth=3pt,
  rightline=false,
  leftline=true,
  topline=false,
  bottomline=false,
  linecolor=black,
  backgroundcolor=RedViolet!5!gray!5,
}
\declaretheoremstyle[
  headfont=\bfseries,
  bodyfont=\normalfont\small,
  spaceabove=0pt,
  spacebelow=0pt,
  mdframed={style=mdblackbox}
]{thmblackbox}

% Purple big theorem box (not used by default, but available)
\mdfdefinestyle{mdpurplebox}{%
  roundcorner=10pt,
  linewidth=1pt,
  skipabove=12pt,
  skipbelow=12pt,
  innertopmargin=9pt,
  innerbottommargin=9pt,
  linecolor=black,
  nobreak=true,
  backgroundcolor=Orchid!10,
  shadow=true,
  shadowsize=6pt,
  shadowcolor=black!30,
  frametitleaboveskip=8pt,
  frametitlebelowskip=8pt,
  frametitlebackgroundcolor=Violet!50!black,
  frametitlefont=\bfseries\sffamily\color{white},
  frametitlerule=true,
}
\newcommand{\listhack}{$\empty$\vspace{-2em}}

% --------------------------------------------------------------------
% Theorem environments
% --------------------------------------------------------------------
\theoremstyle{definition}

% Number by section
\declaretheorem[style=thmbluebox,name=Theorem,numberwithin=section]{theorem}
\declaretheorem[style=thmbluebox,name=Lemma,sibling=theorem]{lemma}
\declaretheorem[style=thmbluebox,name=Proposition,sibling=theorem]{proposition}
\declaretheorem[style=thmbluebox,name=Corollary,sibling=theorem]{corollary}
\declaretheorem[style=thmbluebox,name=Assumption,sibling=theorem]{assume}

\declaretheorem[style=thmbluebox,name=Theorem,numbered=no]{theorem*}
\declaretheorem[style=thmbluebox,name=Lemma,numbered=no]{lemma*}
\declaretheorem[style=thmbluebox,name=Proposition,numbered=no]{proposition*}
\declaretheorem[style=thmbluebox,name=Corollary,numbered=no]{corollary*}
\declaretheorem[style=thmbluebox,name=Assumption,numbered=no]{assume*}

\declaretheorem[style=thmgreenbox,name=Algorithm,sibling=theorem]{algorithm}
\declaretheorem[style=thmgreenbox,name=Algorithm,numbered=no]{algorithm*}
\declaretheorem[style=thmgreenbox,name=Claim,sibling=theorem]{claim}
\declaretheorem[style=thmgreenbox,name=Claim,numbered=no]{claim*}

\declaretheorem[style=thmredbox,name=Example,sibling=theorem]{example}
\declaretheorem[style=thmredbox,name=Example,numbered=no]{example*}

\declaretheorem[style=thmblackbox,name=Remark,sibling=theorem]{remark}
\declaretheorem[style=thmblackbox,name=Remark,numbered=no]{remark*}

\declaretheoremstyle[
  headfont=\color{blue!40!black}\normalfont\bfseries,
  spaceabove=8pt,
  spacebelow=8pt,
  bodyfont=\normalfont
]{basehead}

\declaretheorem[style=basehead,name=Answer,sibling=theorem]{answer}
\declaretheorem[style=basehead,name=Answer,numbered=no]{answer*}
\declaretheorem[style=basehead,name=Conjecture,sibling=theorem]{conjecture}
\declaretheorem[style=basehead,name=Conjecture,numbered=no]{conjecture*}
\declaretheorem[style=basehead,name=Definition,sibling=theorem]{definition}
\declaretheorem[style=basehead,name=Definition,numbered=no]{definition*}
\declaretheorem[style=basehead,name=Exercise,sibling=theorem]{exercise}
\declaretheorem[style=basehead,name=Exercise,numbered=no]{exercise*}
\declaretheorem[style=basehead,name=Fact,sibling=theorem]{fact}
\declaretheorem[style=basehead,name=Fact,numbered=no]{fact*}
\declaretheorem[style=basehead,name=Problem,sibling=theorem]{problem}
\declaretheorem[style=basehead,name=Problem,numbered=no]{problem*}

\declaretheorem[style=basehead,name=Case]{case}

% --------------------------------------------------------------------
% KOMA-script section/chapter formatting (if used)
% --------------------------------------------------------------------
\@ifundefined{KOMAClassName}{}{%
  \@ifundefined{chapter}{}{%
    \addtokomafont{partprefix}{\rmfamily}
    \renewcommand*{\partformat}{\color{purple}
      \scalebox{2.5}{\thepart}}
    \addtokomafont{chapterprefix}{\raggedleft}
    \RedeclareSectionCommand[beforeskip=0.5em]{chapter}
    \renewcommand*{\chapterformat}{\mbox{%
      \scalebox{1.5}{\chapappifchapterprefix{\nobreakspace}}%
      \scalebox{2.718}{\color{purple}\thechapter}\enskip}}
  }
  \renewcommand*{\sectionformat}{\color{purple}\S\thesection\enskip}
  \renewcommand*{\subsectionformat}{\color{purple}\S\thesubsection\enskip}
  \renewcommand*{\subsubsectionformat}{\color{purple}\S\thesubsubsection\enskip}
  \addtokomafont{paragraph}{\color{orange!35!black}\P\ }
  \KOMAoptions{numbers=noenddot}
}

\RedeclareSectionCommand[tocbeforeskip=0.5em]{subsection} % Increase spacing for subsections

% --------------------------------------------------------------------
% \maketitle configuration (for KOMA)
% --------------------------------------------------------------------
\@ifundefined{KOMAClassName}{}{%
  \addtokomafont{subtitle}{\Large}
  \setkomafont{author}{\Large\scshape}
  \setkomafont{date}{\Large\normalsize}
}
\providecommand{\thetitle}{\@title}
\providecommand{\theauthor}{\@author}
\providecommand{\thedate}{\@date}

% --------------------------------------------------------------------
% Page setup / headers
% --------------------------------------------------------------------
\@ifundefined{KOMAClassName}{%
  % Standard classes
  \usepackage{fancyhdr}
  \setlength{\headheight}{0.75in}
  \setlength{\oddsidemargin}{0in}
  \setlength{\evensidemargin}{0in}
  % let class control \voffset and \textheight
  \setlength{\headsep}{10pt}
  \setlength{\textwidth}{6.5in}
  \setlength{\headwidth}{6.5in}
  \setlength{\parskip}{1ex plus 0.5ex minus 0.2ex}
  \setlength{\footskip}{0.3in}
}{%
  % KOMA-Script
  \usepackage[headsepline]{scrlayer-scrpage}
  \renewcommand{\headfont}{}
  % do not enlarge textheight to avoid overflow
  \setlength{\footskip}{0.5in}
  \setlength{\headsep}{10pt}
  \ihead{\footnotesize\textbf{\theauthor} --- \thedate}
  \automark{section}
  \chead{}
  \ohead{\footnotesize\textbf{\thetitle}}
  \cfoot{\pagemark}
}

\makeatother
